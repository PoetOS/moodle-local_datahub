define(["jquery","local_datahub/papaparse","core/templates","core/modal_factory","core/log","core/str"],function(a,b,c,d,e,f){"use strict";function g(){Y.log("launch_warning()"),k.show(),a("#confirm_manualrun_modal").click(function(a){Y.log("click confirm"),window.location.href=l}),a("#close_manualrun_modal").click(function(b){Y.log("click close"),k.hide(),a("#close_manualrun_modal, #confirm_manualrun_modal").unbind("click")})}function h(){var b=a("#create_modal"),c='<button type="button" class="btn btn-secondary" id="close_manualrun_modal">Close</button><button type="button" class="btn btn-primary" id="confirm_manualrun_modal">'+m[2]+"</button>";d.create({title:m[0],body:"<p>"+m[1]+"</p>",footer:c},b).done(function(a){Y.log("modal created"),k=a})}function i(c){var d=a("#"+c).parents(".fitem").find(".filepicker-filename a");d=a(d).attr("href");var e,f,h;e=a.ajax({type:"GET",url:d,dataType:"text/csv",error:function(a){Y.log("Error fetching CSV for size check: "),Y.log(a.errors)},complete:function(a){Y.log("CSV fetch complete."),f=a.responseText,h=b.parse(f);var c=h.data.length-2;Y.log("length is "+c),c>50&&g()}})}function j(){Y.log("bind_events"),a("#id_file0, #id_file1, #id_file2").on("change",function(b){Y.log("Change to: "+b.target);var c=a(b.target).attr("id");i(c)})}var k,l="",m=[];return{initialize:function(b){a(document).ready(function(){Y.log("manualrun.js init."),Y.log(b),l=b,f.get_strings([{key:"importwarningheader",component:"local_datahub"},{key:"importwarningcontent",component:"local_datahub"},{key:"importwarningconfirm",component:"local_datahub"}]).done(function(a){m=a,console.log(a),h()}).fail(console.log("Loading of strings failed.")),j()})}}});