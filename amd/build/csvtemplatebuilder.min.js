define(["jquery","core/log"],function(a,b){function c(){var b=a("#csvmodal"),c=new M.core.dialogue({headerContent:"",bodyContent:b.html(),draggable:!0,visible:!1,center:!0,modal:!0,width:800});b.remove(),a("#csvtemplatelauncher").on("click",function(a){c.show(),a.preventDefault()}),a("#csvtemplatebuilder #csvtemplatetypeselect").on("change",function(){var b=a(this).val();Y.log("selected template file: "+b),a("#removecsvfield").attr("disabled","disabled"),a("#addcsvfield").attr("disabled","disabled"),a("#csvtemplatedownload").attr("disabled","disabled"),e(b)}),a("#csvtemplatebuilder #addselect").on("change",function(){var b=a(this).val();null!=b&&b.length>0?a("#addcsvfield").removeAttr("disabled"):a("#addcsvfield").attr("disabled","disabled")}),a("#addcsvfield").on("click",function(){for(var b=a("#csvtemplatebuilder #addselect").val(),c=0;c<b.length;c++){var e=b[c];a("#csvtemplatebuilder #addselect option[value='"+e+"']").appendTo(a("#csvtemplatebuilder #removeselect"))}a("#csvtemplatebuilder #removeselect").trigger("change"),a("#csvtemplatebuilder #addselect").trigger("change"),d()}),a("#csvtemplatebuilder #removeselect").on("change",function(){var b=a(this).val();null!=b&&b.length>0?a("#removecsvfield").removeAttr("disabled"):a("#removecsvfield").attr("disabled","disabled")}),a("#removecsvfield").on("click",function(){for(var b=a("#csvtemplatebuilder #removeselect").val(),c=0;c<b.length;c++){var e=b[c];a("#csvtemplatebuilder #removeselect option[value='"+e+"']").appendTo(a("#csvtemplatebuilder #addselect"))}a("#csvtemplatebuilder #removeselect").trigger("change"),a("#csvtemplatebuilder #addselect").trigger("change"),d()})}function d(){$csvfields=a("#removeselect option");var b={};$csvfields.each(function(){b[a(this).val()]=1}),Y.log("Current CSV fields:"),Y.log(b),a("form#csvbuilder input[name='fields']").val(JSON.stringify(b)),a("#csvtemplatedownload").removeAttr("disabled")}function e(b){a("#csvtemplatebuilder #removeselect, #csvtemplatebuilder #addselect").html(""),b&&a.ajax({type:"GET",url:"./templates/csv/"+b+"?v=1",dataType:"text",success:function(c){var d=c.split("\n")[0],e=d.split(",");a("form#csvbuilder input[name='file']").val(b),f(e)}})}function f(b){for(var c=0;c<b.length;c++){var e=b[c];"*"==e.substr(0,1)?a("#csvtemplatebuilder #removeselect").append("<option disabled>"+e+"</option>"):a("#csvtemplatebuilder #addselect").append('<option value="'+e+'">'+e+"</option>")}d()}return{initialize:function(){a(document).ready(function(){Y.log("csvtemplatebuilder.js init."),setTimeout(c,500)})}}});